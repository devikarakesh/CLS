{% extends 'student/studentdashboard.html' %}
{% load custom_filters %}
{% block body %}

<style>
    table {
        width: 80%;
        border-collapse: collapse;
        margin-left: 280px;
    }
    table, th, td {
        border: 1px solid black;
    }
    th, td {
        padding: 10px;
        text-align: center;
    }
    th {
        background-color: #f2f2f2;
    }
    .filter {
        margin-left: 300px;
        margin-top: 35px;
        margin-bottom: 25px;
    }
</style>

<h2>Timetable</h2>

<!-- Class Filter Dropdown -->
<div class="filter">
    <label for="classFilter">Filter by Class:</label>
    <select id="classFilter">
        <option value="all">All Classes</option>
        {% for cls in timetable_data.keys %}
            <option value="{{ cls.Semester }}">{{ cls.Semester }}</option>
        {% endfor %}
    </select>
</div>

{% for cls, days_data in timetable_data.items %}
    <h3>Class: {{ cls.Semester }}</h3>
    <table class="timetable">
        <thead>
            <tr>
                <th>Day/Period</th>
                {% for period in periods %}
                    <th>Period {{ period }}</th>
                {% endfor %}
            </tr>
        </thead>
        <tbody>
            {% for day in days %}
                <tr>
                    <td>{{ day }}</td>
                    {% for period in periods %}
                        <td class="entry" data-faculty-id="{% with days_data|get_item:day|get_item:period as entry %}{% if entry %}{{ entry.faculty.id }}{% else %}none{% endif %}{% endwith %}">
                            {% with days_data|get_item:day|get_item:period as entry %}
                                {% if entry %}
                                    {{ entry.subject.name }}<br>
                                    (faculty: {{ entry.faculty.name }})
                                {% else %}
                                    Free
                                {% endif %}
                            {% endwith %}
                        </td>
                    {% endfor %}
                </tr>
            {% endfor %}
        </tbody>
    </table>
{% endfor %}

<script>
document.getElementById('classFilter').addEventListener('change', function () {
    const selectedClass = this.value;
    const timetables = document.querySelectorAll('.timetable');

    timetables.forEach(table => {
        // Get the preceding h3 element which displays the class name.
        const classTitle = table.previousElementSibling; 
        const className = classTitle.textContent.replace("Class: ", "").trim();

        // Show or hide timetable based on the selected class
        if (selectedClass === "all" || className === selectedClass) {
            table.style.display = "table"; // Show table
            classTitle.style.display = "block"; // Show class heading
        } else {
            table.style.display = "none"; // Hide table
            classTitle.style.display = "none"; // Hide class heading
        }
    });
});
</script>

{% endblock %}
